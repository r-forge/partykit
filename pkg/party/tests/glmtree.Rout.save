
R version 3.3.1 (2016-06-21) -- "Bug in Your Hair"
Copyright (C) 2016 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> 
> library("partyNG")
Loading required package: partykit
Loading required package: grid
Loading required package: libcoin

Attaching package: 'partyNG'

The following objects are masked from 'package:partykit':

    ctree, ctree_control, glmtree

> library("sandwich")
> library("libcoin")
> data("PimaIndiansDiabetes", package = "mlbench")
> 
> 
> ## partykit: recursive partitioning of a logistic regression model
> pid_tree <- partykit::glmtree(diabetes ~ glucose | pregnant +
+        pressure + triceps + insulin + mass + pedigree + age,
+        data = PimaIndiansDiabetes, family = binomial)
> 
> pid_tree
Generalized linear model tree (family: binomial)

Model formula:
diabetes ~ glucose | pregnant + pressure + triceps + insulin + 
    mass + pedigree + age

Fitted party:
[1] root
|   [2] mass <= 26.3: n = 167
|       (Intercept)     glucose 
|       -9.95150963  0.05870786 
|   [3] mass > 26.3
|   |   [4] age <= 30: n = 304
|   |       (Intercept)     glucose 
|   |       -6.70558554  0.04683748 
|   |   [5] age > 30: n = 297
|   |       (Intercept)     glucose 
|   |       -2.77095386  0.02353582 

Number of inner nodes:    2
Number of terminal nodes: 3
Number of parameters per node: 2
Objective function (negative log-likelihood): 355.4578
> 
> nd <- factor(predict(pid_tree, type = "node"))
> m <- glm(diabetes ~ glucose:nd, data = PimaIndiansDiabetes, family = binomial)
> logLik(m)
'log Lik.' -371.2402 (df=4)
> AIC(m)
[1] 750.4804
> 
> pid_tree1 <- partyNG::glmtree(diabetes ~ glucose | pregnant +
+        pressure + triceps + insulin + mass + pedigree + age,
+        data = PimaIndiansDiabetes, family = binomial)
> 
> pid_tree1

Model formula:
diabetes ~ glucose + (pregnant + pressure + triceps + insulin + 
    mass + pedigree + age)

Fitted party:
[1] root
|   [2] mass <= 27.3: neg (n = 194, err = 10.3%)
|   [3] mass > 27.3
|   |   [4] pregnant <= 6
|   |   |   [5] age <= 30
|   |   |   |   [6] pressure <= 30: pos (n = 11, err = 18.2%)
|   |   |   |   [7] pressure > 30: neg (n = 276, err = 26.4%)
|   |   |   [8] age > 30: pos (n = 152, err = 47.4%)
|   |   [9] pregnant > 6
|   |   |   [10] pedigree <= 0.42: neg (n = 69, err = 47.8%)
|   |   |   [11] pedigree > 0.42: pos (n = 66, err = 19.7%)

Number of inner nodes:    5
Number of terminal nodes: 6
> 
> info_node(node_party(pid_tree1))
$criterion
          diabetes glucose      pregnant   pressure    triceps    insulin
statistic       NA      NA  3.317490e+00  1.1135597  0.9486972  0.5595295
p.value         NA      NA  7.141460e-06  0.8214012  0.8946627  0.9770789
criterion     -Inf    -Inf -7.141485e-06 -1.7226131 -2.2505879 -3.7756979
                   mass     pedigree          age
statistic  3.533630e+00  2.704429061  2.827940082
p.value    2.559929e-07  0.003971207  0.001488445
criterion -2.559929e-07 -0.003979114 -0.001489554

$p.value
        mass 
2.559929e-07 

$coef
xs(Intercept)     xsglucose 
  -5.35008039    0.03787304 

$logLik
'log Lik.' -404.3598 (df=2)

> 
> nd1 <- factor(predict(pid_tree1, type = "node"))
> m1 <- glm(diabetes ~ glucose:nd1, data = PimaIndiansDiabetes, family = binomial)
> logLik(m1)
'log Lik.' -351.1761 (df=7)
> AIC(m1)
[1] 716.3523
> 
> 
> table(nd, nd1)
   nd1
nd    2   6   7   8  10  11
  2 167   0   0   0   0   0
  4  14  11 276   0   3   0
  5  13   0   0 152  66  66
> 
> pid_tree2 <- partyNG::glmtree(diabetes ~ glucose | pregnant +
+        pressure + triceps + insulin + mass + pedigree + age,
+        data = PimaIndiansDiabetes, family = binomial, 
+        control = ctree_control(nmax = 20))
> 
> pid_tree2

Model formula:
diabetes ~ glucose + (pregnant + pressure + triceps + insulin + 
    mass + pedigree + age)

Fitted party:
[1] root
|   [2] mass <= 27.3: neg (n = 194, err = 10.3%)
|   [3] mass > 27.3
|   |   [4] pregnant <= 6
|   |   |   [5] pedigree <= 0.687: neg (n = 347, err = 33.4%)
|   |   |   [6] pedigree > 0.687: neg (n = 92, err = 50.0%)
|   |   [7] pregnant > 6: pos (n = 135, err = 36.3%)

Number of inner nodes:    3
Number of terminal nodes: 4
> 
> info_node(node_party(pid_tree2))
$criterion
          diabetes glucose      pregnant   pressure    triceps    insulin
statistic       NA      NA  3.319902e+00  1.3267391  1.0685616  0.8143844
p.value         NA      NA  6.907465e-06  0.6844712  0.8442133  0.9350822
criterion     -Inf    -Inf -6.907489e-06 -1.1535052 -1.8592676 -2.7346338
                   mass     pedigree          age
statistic  3.369350e+00  2.858079978  2.602309286
p.value    3.426695e-06  0.001149304  0.008188344
criterion -3.426701e-06 -0.001149965 -0.008222052

$p.value
        mass 
3.426695e-06 

$coef
x(Intercept)     xglucose 
   -5.429598     0.037722 

$logLik
'log Lik.' -399.7571 (df=2)

> 
> nd2 <- factor(predict(pid_tree2, type = "node"))
> m2 <- glm(diabetes ~ glucose:nd2, data = PimaIndiansDiabetes, family = binomial)
> logLik(m2)
'log Lik.' -368.7587 (df=5)
> AIC(m2)
[1] 747.5174
> 
> 
> table(nd, nd2)
   nd2
nd    2   5   6   7
  2 167   0   0   0
  4  14 232  55   3
  5  13 115  37 132
> table(nd1, nd2)
    nd2
nd1    2   5   6   7
  2  194   0   0   0
  6    0   7   4   0
  7    0 225  51   0
  8    0 115  37   0
  10   0   0   0  69
  11   0   0   0  66
> 
> proc.time()
   user  system elapsed 
  2.028   0.060   2.087 
