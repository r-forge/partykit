---
title: "model4you reproducing "Model-Based Recursive Partitioning for Subgroup Analyses""
author: "Heidi Seibold"
date: "December 22, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library("model4you")
library("survival")
load("data/ALSFRSdata.rda")
load("data/ALSsurvdata.rda")
```

## Base models
```{r}
bm_alsfrs <- glm(ALSFRS.Start ~ Riluzole + offset(log(ALSFRS.halfYearAfter)), 
                 data = ALSFRSdata, family = gaussian(link = "log"))
summary(bm_alsfrs)

bm_alssurv_wb <- survreg(Surv(survival.time, cens) ~ Riluzole, 
                         data = ALSsurvdata, dist = "weibull")
summary(bm_alssurv_wb)

bm_alssurv_cox <- coxph(Surv(survival.time, cens) ~ Riluzole, 
                        data = ALSsurvdata)
summary(bm_alssurv_cox)
```

## Trees

```{r}
set.seed(123)

(tr_alsfrs <- pmtree(bm_alsfrs, control = ctree_control(maxdepth = 2)))
plot(tr_alsfrs, terminal_panel = node_pmterminal(tr_alsfrs, plotfun = lm_plot, 
                                                 confint = FALSE))


(tr_alssurv_wb <- pmtree(bm_alssurv_wb, control = ctree_control(maxdepth = 2)))
plot(tr_alssurv_wb, terminal_panel = node_pmterminal(tr_alssurv_wb, plotfun = survreg_plot, 
                                                     confint = TRUE))


(tr_alssurv_cox <- pmtree(bm_alssurv_cox, control = ctree_control(maxdepth = 2)))
```


